"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[413],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=l(n),h=r,g=u["".concat(p,".").concat(h)]||u[h]||m[h]||i;return n?a.createElement(g,s(s({ref:t},c),{},{components:n})):a.createElement(g,s({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=u;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var l=2;l<i;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7933:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const i={slug:"2021-10-29/terminating-namespaces",title:"Terminating Namespaces",authors:["Peter"],tags:["Kubernetes","Troubleshooting"]},s=void 0,o={permalink:"/2021-10-29/terminating-namespaces",source:"@site/blog/2021-10-29/index.md",title:"Terminating Namespaces",description:"Terminating Namespaces Hero",date:"2021-10-29T00:00:00.000Z",formattedDate:"October 29, 2021",tags:[{label:"Kubernetes",permalink:"/tags/kubernetes"},{label:"Troubleshooting",permalink:"/tags/troubleshooting"}],readingTime:1.64,hasTruncateMarker:!0,authors:[{name:"Peter Keech",title:"DevOps Engineer",url:"https://github.com/pkeech",imageURL:"https://github.com/pkeech.png",key:"Peter"}],frontMatter:{slug:"2021-10-29/terminating-namespaces",title:"Terminating Namespaces",authors:["Peter"],tags:["Kubernetes","Troubleshooting"]},nextItem:{title:"K3S Cluster with vSphere Storage (Part I)",permalink:"/2021-07-03/k3s-cluster-with-vsphere-storage-part-i"}},p={authorsImageUrls:[void 0]},l=[],c={toc:l};function m(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Terminating Namespaces Hero",src:n(5557).Z,width:"1400",height:"933"})),(0,r.kt)("p",null,"After you start playing around with ",(0,r.kt)("em",{parentName:"p"},"Kubernetes"),", or even ",(0,r.kt)("em",{parentName:"p"},"Red Hat OpenShif"),"t, you are potentially going to run into an issue that I\u2019ve had to encounter many times. Sometimes it happens quickly, other times it takes longer, but eventually you will run into the issue of a namespace trying to terminate but appear to be stuck."),(0,r.kt)("p",null,"The TLDR of this issue, is that the ",(0,r.kt)("strong",{parentName:"p"},"Kubernetes Finalizer")," of the namespace fails to complete successfully leaving you with a namespace that is \u201cterminating\u201d."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"After performing extensive research on this topic, modifying the ",(0,r.kt)("strong",{parentName:"p"},"Kubernetes Finalizer")," may cause unexpected results. There have been instances where the ",(0,r.kt)("em",{parentName:"p"},"namespace")," was removed via the ",(0,r.kt)("strong",{parentName:"p"},"Kubernetes Finalizer")," and when creating a namespace of the same name, artifacts from the previous namespace remained (i.e. Pods ). "),(0,r.kt)("p",{parentName:"admonition"},"It is important to ensure that all artifacts (Pods, Services, etc.) have been removed prior to running this command.\n")),(0,r.kt)("p",null,"From what I have gathered (so far), the ",(0,r.kt)("strong",{parentName:"p"},"Kubernetes Finalizer")," is essentially the steps that need to be taken prior to a delete action. In this situation, it appears that the Kubernetes Finalizer is ensuring that all of the resources within a namespace have been deleted."),(0,r.kt)("p",null,"In a perfect world, you should track down why the Kubernetes Finalizer failed in the first place and resolve that issue. However, the world isn\u2019t always perfect, and you don\u2019t always have the time. "),(0,r.kt)("p",null,"The following command is a quick, and dirty, way to remove that terminating namespace. In most situations, it will work as expected, but there is a chance that some strange things could happen. I personally have had resources recreated after terminating a namespace and creating a new namespace with the same name as the previous namespace."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Before running this command, be sure to replace \u201cbroken-app\u201d with the namespace that you are trying to remove.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:"showLineNumbers",showLineNumbers:!0},'export ns=broken-app; kubectl get ns "${ns}" -o json | sed s/\\"kubernetes\\"//g | kubectl replace --raw /api/v1/namespaces/"${ns}"/finalize -f -\n')))}m.isMDXComponent=!0},5557:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/TerminatingNamespaces-f34725b716e0ebd84db04d2f4563ce37.png"}}]);