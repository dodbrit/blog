<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="dodbrit RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="dodbrit Atom Feed"><title data-rh="true">Terminating Namespaces | dodbrit</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://blog.dodbrit.dev/2021-10-29/terminating-namespaces"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Terminating Namespaces | dodbrit"><meta data-rh="true" name="description" content="Terminating Namespaces Hero"><meta data-rh="true" property="og:description" content="Terminating Namespaces Hero"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-10-29T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/pkeech"><meta data-rh="true" property="article:tag" content="Kubernetes,Troubleshooting"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.dodbrit.dev/2021-10-29/terminating-namespaces"><link data-rh="true" rel="alternate" href="https://blog.dodbrit.dev/2021-10-29/terminating-namespaces" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.dodbrit.dev/2021-10-29/terminating-namespaces" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.82edc87f.css">
<link rel="preload" href="/assets/js/runtime~main.737cec46.js" as="script">
<link rel="preload" href="/assets/js/main.b6d74a06.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="dodbrit logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="dodbrit logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Home</a><a class="navbar__item navbar__link" href="/archive">Archive</a><a class="navbar__item navbar__link" href="/about">About Me</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/dodbrit/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link github-link" aria-label="GitHub"></a><a href="https://www.linkedin.com/in/peter-keech-b88183a2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link linkedin-link" aria-label="LinkedIn"></a><a href="mailto:peter@dodbrit.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link email-link" aria-label="email"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022-10-13/simple-helm-update">Simple Helm Chart Updates</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/2021-10-29/terminating-namespaces">Terminating Namespaces</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2021-07-03/k3s-cluster-with-vsphere-storage-part-i">K3S Cluster with vSphere Storage (Part I)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2021-07-03/k3s-cluster-with-vsphere-storage-part-ii">K3S Cluster with vSphere Storage (Part II)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2021-07-03/k3s-cluster-with-vsphere-storage-part-iii">K3S Cluster with vSphere Storage (Part III)</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Terminating Namespaces</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-10-29T00:00:00.000Z" itemprop="datePublished">October 29, 2021</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/pkeech" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/pkeech.png" alt="Peter Keech"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/pkeech" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Peter Keech</span></a></div><small class="avatar__subtitle" itemprop="description">DevOps Engineer</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="Terminating Namespaces Hero" src="/assets/images/TerminatingNamespaces-f34725b716e0ebd84db04d2f4563ce37.png" width="1400" height="933" class="img_ev3q"></p><p>After you start playing around with <em>Kubernetes</em>, or even <em>Red Hat OpenShif</em>t, you are potentially going to run into an issue that I’ve had to encounter many times. Sometimes it happens quickly, other times it takes longer, but eventually you will run into the issue of a namespace trying to terminate but appear to be stuck.</p><p>The TLDR of this issue, is that the <strong>Kubernetes Finalizer</strong> of the namespace fails to complete successfully leaving you with a namespace that is “terminating”.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>After performing extensive research on this topic, modifying the <strong>Kubernetes Finalizer</strong> may cause unexpected results. There have been instances where the <em>namespace</em> was removed via the <strong>Kubernetes Finalizer</strong> and when creating a namespace of the same name, artifacts from the previous namespace remained (i.e. Pods ). </p><p>It is important to ensure that all artifacts (Pods, Services, etc.) have been removed prior to running this command.
</p></div></div><p>From what I have gathered (so far), the <strong>Kubernetes Finalizer</strong> is essentially the steps that need to be taken prior to a delete action. In this situation, it appears that the Kubernetes Finalizer is ensuring that all of the resources within a namespace have been deleted.</p><p>In a perfect world, you should track down why the Kubernetes Finalizer failed in the first place and resolve that issue. However, the world isn’t always perfect, and you don’t always have the time. </p><p>The following command is a quick, and dirty, way to remove that terminating namespace. In most situations, it will work as expected, but there is a chance that some strange things could happen. I personally have had resources recreated after terminating a namespace and creating a new namespace with the same name as the previous namespace.</p><p><strong>Before running this command, be sure to replace “broken-app” with the namespace that you are trying to remove.</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ns</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">broken-app</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> kubectl get ns </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${ns}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> -o json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> s/</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;kubernetes</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;//g </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl replace --raw /api/v1/namespaces/</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${ns}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">/finalize -f -</span></span></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/kubernetes">Kubernetes</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/troubleshooting">Troubleshooting</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/2022-10-13/simple-helm-update"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Simple Helm Chart Updates</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/2021-07-03/k3s-cluster-with-vsphere-storage-part-i"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">K3S Cluster with vSphere Storage (Part I)</div></a></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 <br><i>Posts have been created from personal experiences working on personal and professional projects and have not been influenced by any vendor. Built with Docusaurus.</i></div></div></div></footer></div>
<script src="/assets/js/runtime~main.737cec46.js"></script>
<script src="/assets/js/main.b6d74a06.js"></script>
</body>
</html>